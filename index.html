<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>年賀AR（安定版）</title>

  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
  <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>

  <style>
    html, body { margin: 0; height: 100%; overflow: hidden; background: #000; }

    /* ✅ ここが肝：AR.jsが作るカメラvideoだけを「歪まず画面に収める」 */
    video.arjs-video {
      position: fixed !important;
      inset: 0 !important;
      width: 100vw !important;
      height: 100vh !important;
      object-fit: contain !important;   /* ← 収める（黒帯OK、歪まない） */
      background: #000 !important;
      z-index: 0 !important;
    }

    /* ❌ canvas は固定配置やobject-fitをしない（黒画面の原因になりやすい） */
    canvas.a-canvas { z-index: 1 !important; }

    .ui {
      position: fixed; left: 0; right: 0; top: 0;
      padding: 10px 12px;
      background: rgba(0,0,0,0.55);
      color: #fff;
      font: 14px/1.4 system-ui, -apple-system, "Segoe UI", sans-serif;
      z-index: 10;
    }
  </style>
</head>

<body>
  <div class="ui">カメラを許可 → <b>Hiroマーカー</b>にかざしてください</div>

  <a-scene
    embedded
    vr-mode-ui="enabled: false"
    renderer="antialias: true; colorManagement: true;"
    arjs="
      sourceType: webcam;
      facingMode: environment;
      debugUIEnabled: false;
      sourceWidth: 1280; sourceHeight: 720;
    "
  >
    <!-- ズーム感が強いなら 70〜80。まず70 -->
    <a-entity camera="fov: 70;"></a-entity>

    <!-- 画像を確実に読み込ませる -->
    <a-assets>
      <img id="ov" src="overlay.png" />
    </a-assets>

    <a-marker preset="hiro">
      <!-- a-imageより a-plane+material の方が端末依存が少なく安定しやすい -->
      <a-plane
        position="0 0 0"
        rotation="-90 0 0"
        width="1.4"
        height="1.4"
        material="src: #ov; transparent: true; alphaTest: 0.1;"
      ></a-plane>
    </a-marker>

    <a-entity light="type: ambient; intensity: 0.9"></a-entity>
  </a-scene>
</body>
</html>
