<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>年賀状AR</title>

<!-- MindAR Core (Three.js版) -->
<script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-three.prod.js"></script>

<style>
html, body {
  margin: 0;
  height: 100%;
  overflow: hidden;
  background: #000;
}

/* MindARが生成するcanvasを全画面に */
#container {
  position: fixed;
  inset: 0;
}

/* 年賀状動画 */
#overlay {
  position: fixed;
  inset: 0;
  width: 100%;
  height: 100%;
  object-fit: contain;
  display: none;
  z-index: 2;
}

/* 開始UI */
#ui {
  position: fixed;
  inset: 0;
  z-index: 3;
  display: flex;
  align-items: center;
  justify-content: center;
  background: rgba(0,0,0,.85);
}
button {
  font-size: 18px;
  font-weight: 800;
  padding: 16px 24px;
  border-radius: 14px;
  border: none;
}
</style>
</head>

<body>

<div id="container"></div>

<video id="overlay"
  src="./overlay.mp4"
  loop
  muted
  playsinline
  webkit-playsinline>
</video>

<div id="ui">
  <button id="start">はじめる</button>
</div>

<script>
const container = document.getElementById("container");
const overlay = document.getElementById("overlay");
const ui = document.getElementById("ui");

document.getElementById("start").onclick = async () => {

  /* MindAR Three.js Core */
  const mindarThree = new window.MINDAR.IMAGE.MindARThree({
    container: container,
    imageTargetSrc: "./targets.mind"
  });

  const { renderer, scene, camera } = mindarThree;

  /* ターゲット0 */
  const anchor = mindarThree.addAnchor(0);

  anchor.onTargetFound = () => {
    overlay.style.display = "block";
    overlay.play();
  };

  anchor.onTargetLost = () => {
    overlay.pause();
    overlay.currentTime = 0;
    overlay.style.display = "none";
  };

  await mindarThree.start();

  renderer.setAnimationLoop(() => {
    renderer.render(scene, camera);
  });

  ui.style.display = "none";
};
</script>

</body>
</html>
