<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>年賀状AR</title>

  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>

  <style>
    html, body { margin:0; height:100%; overflow:hidden; background:#000; }
    /* VR / XR ボタン完全排除 */
    .a-enter-vr, .a-enter-ar, .a-enter-xr,
    .a-enter-vr-button, .a-enter-ar-button, .a-enter-xr-button {
      display:none !important;
    }
    #ui{
      position:fixed; inset:0; z-index:10;
      display:flex; align-items:center; justify-content:center;
      background:rgba(0,0,0,.85);
      color:#fff; font-family:system-ui;
    }
    button{
      padding:16px 20px;
      font-size:18px; font-weight:800;
      border-radius:14px; border:0;
    }
  </style>
</head>

<body>

<div id="ui">
  <button id="startBtn">はじめる</button>
</div>

<a-scene
  vr-mode-ui="enabled:false"
  device-orientation-permission-ui="enabled:false"
  renderer="
    antialias: true;
    alpha: true;
    physicallyCorrectLights: false;
    colorManagement: false;
    logarithmicDepthBuffer: false;
  "
  mindar-image="
    imageTargetSrc: ./targets.mind;
    autoStart: false;
    uiScanning: false;
    uiLoading: false;
  ">

  <a-assets>
    <video
      id="ov"
      src="./overlay.mp4"
      loop
      muted
      playsinline
      webkit-playsinline>
    </video>
  </a-assets>

  <a-entity mindar-image-target="targetIndex:0">
    <a-video
      src="#ov"
      width="1.0"
      height="0.56">
    </a-video>
  </a-entity>

  <!-- ⚠️ 通常の a-camera は使わない -->
  <a-camera
    look-controls="enabled:false"
    position="0 0 0">
  </a-camera>

</a-scene>

<script>
  const btn = document.getElementById('startBtn');
  const ui  = document.getElementById('ui');
  const scene = document.querySelector('a-scene');
  const ov = document.getElementById('ov');

  btn.onclick = async () => {
    try {
      // iOS 対策：ユーザー操作で video を触る
      try { await ov.play(); } catch(_) {}

      const sys = scene.systems["mindar-image-system"];
      await sys.start();

      ui.style.display = "none";
    } catch(e) {
      alert("起動失敗：" + e.message);
    }
  };
</script>

</body>
</html>
